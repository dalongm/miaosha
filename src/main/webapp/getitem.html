<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html>
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>商品详情</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" rel="stylesheet" href="static\assets\global\plugins\bootstrap\css\bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="static\assets\global\css\components.css" />
    <link type="text/css" rel="stylesheet" href="static\admin\pages\css\login.css" />
    <script src="static\assets\global\plugins\jquery-1.11.0.min.js" type="text/javascript"></script>
</head>

<body class="login">
    <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <div class="content">
        <h3 class="form-title">商品详情</h3>
        <div class="form-group">
            <div>
                <label class="control-label" id="title">
            </div>
        </div>
        <div class="form-group">
            <label class="control-label">商品描述</label>
            <div>
                <label class="control-label" id="decription">
            </div>
        </div>
        <div class="form-group">
            <label class="control-label">价格</label>
            <div>
                <label class="control-label" id="price">
            </div>
        </div>
        <div class="form-group">
            <div>
                <img style="height:200px;width:auto;" id="imgUrl">
            </div>
        </div>
        <div class="form-group">
            <label class="control-label">库存</label>
            <div>
                <label class="control-label" id="stock">
            </div>
        </div>
        <div class="form-group">
            <label class="control-label">销量</label>
            <div>
                <label class="control-label" id="sales">
            </div>
        </div>
        <div class="form-actions">
            <button class="btn blue" id="createorder" type="submit">
                下单
            </button>
        </div>
    </div>
    <script>

        function getParam(paramName) {
            paramValue = "", isFound = !1;
            if (this.location.search.indexOf("?") == 0 && this.location.search.indexOf("=") > 1) {
                arrSource = unescape(this.location.search).substring(1, this.location.search.length).split("&"), i = 0;
                while (i < arrSource.length && !isFound) arrSource[i].indexOf("=") > 0 && arrSource[i].split("=")[0].toLowerCase() == paramName.toLowerCase() && (paramValue = arrSource[i].split("=")[1], isFound = !0), i++
            }
            return paramValue == "" && (paramValue = null), paramValue;
        }

        var g_itemVO = {};

        jQuery(document).ready(function () {
            $("#createorder").on("click", function () {
                $.ajax({
                    type: "POST",
                    contentType:"application/x-www-form-urlencoded",
                    url: "http://localhost:8090/order/createorder",
                    data: {
                        "itemId": g_itemVO.id,
                        "amount": 1,
                    },
                    xhrFields: { withCredentials: true },
                    success: function (data) {
                        if (data.status == "success") {
                            alert("下单成功")
                            window.location.reload();
                        } else {
                            alert("下单失败，原因为" + data.data.errMsg);
                            if(data.data.errCode == 20003){
                                window.location.href = "login.html";
                            }
                        }

                    },
                    error: function (data) {
                        alert("下单失败，原因为" + data.responseText);
                    }
                });
            });


            $.ajax({
                type: "GET",
                url: "http://localhost:8090/item/get",
                data: {
                    "id": getParam("id"),
                },
                xhrFields: { withCredentials: true },
                success: function (data) {
                    if (data.status == "success") {
                        g_itemVO = data.data;
                        reloadDom();
                    } else {
                        alert("获取信息失败，原因为" + data.data.errMsg);
                    }

                },
                error: function (data) {
                    alert("获取信息失败，原因为" + data.responseText);
                }
            });
            return false;
        });

        function reloadDom() {
            $("#title").text(g_itemVO.title);
            $("#description").text(g_itemVO.description);
            $("#stock").text(g_itemVO.stock);
            $("#price").text(g_itemVO.price);
            $("#imgUrl").attr("src", g_itemVO.imgUrl);
            $("#sales").text(g_itemVO.sales);
        }
    </script>
</body>

</html>